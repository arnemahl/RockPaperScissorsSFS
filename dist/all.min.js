function run(t){var e=System.parameters,r=System.generated;r.strategyMatrix=Strategy.generateMatrix(e.scount);var n=System;n.players=getPlayers(e.playerCount,e.scount),Statistics.init(e.scount,r.strategyMatrix,n.players),simulate(e.gameCount,n.players,r.strategyMatrix),log.output_all(e.scount,r.strategyMatrix,n.players),repeat=function(t){if(!(1>t)){var n=getPlayers(e.playerCount,e.scount);simulate(e.gameCount,n,r.strategyMatrix),log.output_minimal(e.scount,n),repeat(--t)}},"number"==typeof t&&repeat(--t)}function simulate(t,e,r){var n=e.slice(),a=function(t){return 2===t.length?function(){return t}:function(){for(var e,r,n=t.length;0!==n;)r=Math.floor(Math.random()*n),n-=1,e=t[n],t[n]=t[r],t[r]=e;return t}}(n),i=function(){var t;return function(e,n){return t=r[e][n]}}(),o=function(){if("one"===System.parameters.preferenceUpdate.method){return function(t,e,r){"tie"!==t&&(e.callback(e.strategy,"win"===t),r.callback(r.strategy,"lose"===t))}}return"both"===System.parameters.preferenceUpdate.method?function(t,e,r){"win"===t?(e.callback(e.strategy,r.strategy),r.callback(e.strategy,r.strategy)):"lose"===t&&(e.callback(r.strategy,e.strategy),r.callback(r.strategy,e.strategy))}:void 0}(),s=function(){var e,r,n,s,c=Math.min(System.parameters.logCount,t),u=Math.round(t/c);for(e=0;t>e;e++)e%u===0&&Statistics.collect(e),s=a(),r=s[0].play(),n=s[1].play(),oa=i(r.strategy,n.strategy),o(oa,r,n)},c=function(){var e,r,n,s,c,u,f=Math.min(System.parameters.logCount,t),l=Math.round(t/f);for(e=0;t>e;)for(u=a(),r=0;r<u.length-1&&t>e;r++)for(n=0;n<u.length&&t>e;n++,e++)e%l===0&&Statistics.collect(e),s=u[r].play(),c=u[r].play(),oa=i(s.strategy,c.strategy),o(oa,s,c)};Timer.start(),System.parameters.simulation.minimumShuffling?c():s(),Timer.stop()}var thousand=1e3,million=1e6,System={parameters:{scount:3,playerCount:450,gameCount:250*thousand+1,logCount:250,preferenceUpdate:{method:"one",temperature:{start:.2,min:.01,scl:.05}},simulation:{nofRuns:1,minimumShuffling:!0},output:{timeOnly:!0}},generated:{},players:[]};window.onload=function(){var t=graph_init();run(System.parameters.nofRuns),t.draw()},fbSaveData=function(t){var e=new Firebase("https://rock-paper-scissors-stats.firebaseio.com/");e.push({System:{parameters:System.parameters,generated:System.generated},statistics:Statistics.data,notes:t})};var Timer=function(){var t={};return{start:function(){t.t0=(new Date).valueOf(),delete t.dt},stop:function(){t.dt=(new Date).valueOf()-t.t0},elapsed:function(){return t.dt?t.dt:(new Date).valueOf()-t.t0}}}();StringHelper={addSpacePadding:function(t,e){for(var r=e-t.length,n="        ";n.length<r;)n+=n;return t+n.substring(0,r)}};var log={strategyMatrix:function(t,e,r){var n,a,i,o="Strategy matrix (inverted):\n";for(n=0;t>n;n++){for(a=0;t>a;a++)i=e[a][n],o+=i+"   ";o+="\n"}return o},strategyEfficiency:function(t,e){var r,n,a=Strategy.getUnbiasedEfficiency(t,e);for(string="Unbiased strategy efficiency:\n",r=0;t>r;r++)n=a[r],string+=n.toFixed(2)+"   ";return string+="\n",string},playerPreference:function(t,e){var r,n,a,i=e.length,o="Player preferenes:\n";for(r=0;i>r;r++){for(a=e[r].getPreferences(),n=0;t>n;n++)val=a[n],o+=val.toFixed(2)+"   ";o+="   "+e[r].getName(),o+="\n"}return o},averagePreference:function(t,e){var r,n=Strategy.getAveragePreference(t,e),a="Average preference\n";for(r=0;r<n.length;r++)a+=n[r].toFixed(2)+"   ";return a},preferences:function(t,e){var r=log.playerPreference(t,e)+"\n"+log.averagePreference(t,e)+"-------------------------------------------------";console.log(r)},gamesPlayed:function(t){var e="Games played\n";return Object.keys(t).forEach(function(r){var n=t[r];e+=StringHelper.addSpacePadding(n.getName(),8)+n.getGamesPlayed()+"\n"}),e+="-------------------------------------------------"},elapsedTime:function(){return"Finished in "+Timer.elapsed()+" ms"},output_minimal:function(t,e){if(System.parameters.output.timeOnly)return void log.output_timeOnly();var r=log.averagePreference(t,e)+"\n-------------------------------------------------\n"+log.elapsedTime();console.log(r)},output_all:function(t,e,r){if(System.parameters.output.timeOnly)return void log.output_timeOnly();var n=log.strategyMatrix(t,e)+"\n"+log.strategyEfficiency(t,e)+"\n"+log.playerPreference(t,r)+"\n"+log.averagePreference(t,r)+"\n-------------------------------------------------\n"+log.elapsedTime();console.log(n)},output_timeOnly:function(){console.log(log.elapsedTime())}},createPlayer=function(t,e){var r=0,n=function(){for(var e=[],r=0;t>r;r++)e[r]=1/t;return e}();selectStrategy=function(){var e,r,a;return function(){for(r=0,a=Math.random(),e=0;t>e;e++)if(r+=n[e],r>a)return e;return console.log("ERROR! No strategy selected, sum total:",r),.001>1-r?(console.log("Selected last strategy and moving on"),e):void 0}}();var a=function(){var e,r;return function(){for(e=0,r=0;t>r;r++)e+=n[r];for(r=0;t>r;r++)n[r]/=e}}(),i=function(){var t,e;!function(){var r=System.parameters.preferenceUpdate.temperature,n=r.min,a=r.scl;t=r.start,e=function(){t-=(t-n)*a}}();var r=function(r,i){n[r]*=i?1+t:1-t,e(),a()},i=function(r,i){n[r]*=1+t,n[i]*=1-t,e(),a()};return"one"===System.parameters.preferenceUpdate.method?r:"both"===System.parameters.preferenceUpdate.method?i:void 0}(),o=function(){var t;return{play:function(){return r++,t=selectStrategy(),{strategy:t,callback:i}},getPreferences:function(){return n},getName:function(){return e},getGamesPlayed:function(){return r}}}();return o},getPlayers=function(t,e){for(var r,n=[],a=["Arnold","Bob","Cherry"],i=0;t>i;i++)r=i<a.length?a[i]:""+i,n.push(createPlayer(e,r));return n},Statistics={data:{timings:[],strategies:[]},init:function(t){for(var e=0;t>e;e++){var r={averagePreferences:[]};Statistics.data.strategies.push(r)}},collect:function(t){var e,r,n=System.parameters.scount,a=System.players,i=Statistics.data.timings,o=Statistics.data.strategies;Statistics.collect=function(t){for(i.push(t),r=Strategy.getAveragePreference(n,a),e=0;n>e;e++)o[e].averagePreferences.push(r[e])},Statistics.collect(t)}};Calc={cumulativeMovingAverage:function(t){var e,r=0,n=(t.length,[]);for(n[0]=t[0],e=1;e<t.length;e++)r+=t[e],n[e]=r/e;return n}};var Strategy={};!function(){Strategy.generateMatrix=function(t){var e=[["tie","lose","win"],["win","tie","lose"],["lose","win","tie"]];return e},Strategy.getUnbiasedEfficiency=function(t,e){return[1/3,1/3,1/3]},Strategy.getAveragePreference=function(t,e){var r,n,a,i=e.length,o=[];for(r=0;t>r;r++){for(o[r]=0,n=0;i>n;n++)a=e[n].getPreferences()[r],o[r]+=a;o[r]/=i}return o}}();var drawGraph=function(){function t(t){e=25,r=0,n=t.width-2*e,a=t.height-2*r,i=30,o=40,t=t,s=!0}var e,r,n,a,i,o,s,c=0,u=function(){var t=0,e=.37;return function(){return c++,t=(t+e)%1}}(),f=function(t,r){var o=n-e-i,s={x:function(){var r=t[t.length-1];return function(n){return e+t[n]*o/r}}(),y:function(t){return a*(1-r[t])},labelIndex:function(){var e,r,n=t.length,a=(t[1]-t[0])/2;return function(i){if(e=t.indexOf(Math.round(i)),-1!==e)return e;if(i<t[0])return 0;for(e=0;n>e;e++)if(r=t[e],Math.abs(i-r)<=a)return e;return i>r?n-1:void console.log("omgwtf",i,r,a)}}(),invX:function(){var r,n=t[t.length-1];return function(t){return label_i=(t-e)*n/o,r=s.labelIndex(label_i)}}()};return s},l=function(t,e,r,n,a,i){var o=(r-t)/2,s=(a-r)/2,c=Math.atan((r-t)/Math.abs(n-e)),u=Math.atan((a-r)/Math.abs(n-i));c=n>e?Math.PI-c:c,u=n>i?Math.PI-u:u;var f=Math.PI/2-(c+u)%(2*Math.PI)/2,l=o*Math.sin(f+c),g=o*Math.cos(f+c),y=s*Math.sin(f+u),m=s*Math.cos(f+u);return{x1:r-l,y1:n+g,x2:r+y,y2:n+m}},g=function(t,e,r){var n,a,i=e.length-1,o=["M",r.x(0),r.y(0),"C",r.x(0),r.y(0)];for(n=1;i>n;n++)a=l(r.x(n-1),r.y(n-1),r.x(n),r.y(n),r.x(n+1),r.y(n+1)),o=o.concat([a.x1,a.y1,r.x(n),r.y(n),a.x2,a.y2]);return o=o.concat([r.x(i),r.y(i),r.x(i),r.y(i)])},y=function(t,a,s,u){var f=i,l=i,g=o,y="hsl("+[a,.75,.25]+")",m="hsl("+[a,.5,.5]+")",p=t.rect(e+n-f,r+g*c,f,l).attr({fill:m,"stroke-width":0}),d=t.text(e+n-f/2,r+g*c+l/2,c).attr({fill:y,"font-size":20}),v=t.set(p,d),h=!0,S=function(){u.show(),v.animate({opacity:1},500,">"),p.animate({transform:"r0"},1e3,"elastic"),d.animate({fill:y},500,">")},x=function(){u.hide(),v.animate({opacity:.25},500,">"),p.animate({transform:"r180"},1e3,"elastic"),d.animate({fill:m},500,">")},M=function(){h=!h,h?S():x()};v.click(function(){M()}),v.hover(function(){s.toFront()})},m=function(){var t=25,e=80,r=e/1.618,n=r/3.236,a=2,i=15;return function(o,s,c,u,f,l){var g,y,m,p,d,v,h,S,x,M,P,w,b="hsl("+[f,.75,.25]+")",k="hsl("+[f,.25,.75]+")";return g=u.invX(l),h=u.x(g),S=u.y(g),x=h,M=S,h+(t+e)<o.width?h+=t:h-=t+e,S-(t+r)>0?S-=t+r:S+=t,P=h+e/2,w=S+r/2,o.setStart(),d=o.circle(x,M,1.5*a).attr({fill:b,"stroke-width":0}),p=o.path(["M",x,M,"L",P,w]).attr({stroke:b,"stroke-width":a}),y=o.rect(h,S,e,r,n).attr({fill:k,stroke:b,"stroke-width":a}),m=o.text(P,w,"x: "+s[g].toFixed(0)+"\n y: "+c[g].toFixed(3)).attr({fill:b,"font-size":i,"font-weight":700}),v=o.setFinish().attr({opacity:0,transform:"r-180"}),v.appear=function(t){return t?v.attr({opacity:1,transform:"r0"}):v.animate({opacity:1,transform:"r0"},150,"-")},v.disappear=function(t){return v.animate({opacity:0},150,"-",t)},v}}(),p=function(t,e,r,n,a,i,o){var s;i.hover(function(i,o,c){s=m(t,e,r,n,a,o).appear()},function(){s.disappear(function(){s.remove()})})},d=function(t,e,r,n,a,i,o){i.click(function(i,s,c){var u=m(t,e,r,n,a,s).appear(!0);o.push(u),u.click(function(){u.disappear(function(){u.remove()})})})};return function(e,r,n){s||t(e);var a=u(),i="hsl("+[a,.5,.5]+")",o=f(r,n),c=e.path().attr({path:g(r,n,o),stroke:i,"stroke-width":4,"stroke-linejoin":"round"}),l=e.set(c);p(e,r,n,o,a,c,l),d(e,r,n,o,a,c,l),y(e,a,c,l)}}(),graph_init=function(){var t=Raphael("graph",window.innerWidth-20,window.innerHeight-20);return{draw:function(){var e;for(e=0;e<System.parameters.scount;e++)drawGraph(t,Statistics.data.timings,Statistics.data.strategies[e].averagePreferences);for(e=0;e<System.parameters.scount;e++)drawGraph(t,Statistics.data.timings,Calc.cumulativeMovingAverage(Statistics.data.strategies[e].averagePreferences))}}};